<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate User Data</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            text-align: center;
            margin-top: 50px;
        }
        input {
            padding: 8px;
            width: 150px;
            font-size: 16px;
        }
        button {
            padding: 8px 16px;
            font-size: 16px;
            margin-left: 10px;
            cursor: pointer;
        }
        #status {
            margin-top: 20px;
            color: #666;
        }
        .error {
            color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Generate User Data</h1>
        <p>请输入要生成的用户数据数量：</p>
        <input type="number" id="userCount" min="1" max="10000" value="10" placeholder="输入数量">
        <button onclick="generateAndDownload()">生成并下载</button>
        <p id="status"></p>
    </div>

    <script>
        // 生成UUID函数
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16).toUpperCase();
            });
        }

        // 生成随机时间戳（基于原始数据的时间范围）
        function generateTimestamp() {
            // 原始数据的时间范围大约在1763002190左右
            const baseTime = 1763002190;
            const randomOffset = Math.floor(Math.random() * 86400 * 360); // 360天内的随机偏移
            return baseTime - randomOffset + Math.random();
        }

        // 生成ad_event数据
        function generateAdEvents() {
            const adEventTypes = [
                "ado_req_start", "ado_req_success", "ado_display_start", "ado_display_success", "ado_display_fail",
                "ado_click", "ado_req_fail"
            ];
            
            const eventsCount = Math.floor(Math.random() * 10) + 3; // 3-12个事件
            const events = {};
            
            for (let i = 0; i < eventsCount; i++) {
                const eventId = generateUUID();
                const eventType = adEventTypes[Math.floor(Math.random() * adEventTypes.length)];
                const eventData = {
                    event_name: eventType,
                    timestamp: generateTimestamp()
                };
                
                // 如果是失败事件，添加原因
                if (eventType === "ad_open_req_fail") {
                    eventData.reason = "Presentation Error: Will not present ad because ad object has been used.";
                }
                
                events[eventId] = eventData;
            }
            
            return events;
        }

        // 生成info数据
        function generateInfo(userId) {
            const countries = ["MY", "US", "CN", "JP", "GB", "DE", "FR", "CA", "AU", "SG"];
            const languages = ["en", "zh", "ja", "de", "fr", "es", "ko", "ru"];
            const models = ["iPhone", "iPhone Pro", "iPhone Pro Max", "Samsung Galaxy", "Google Pixel", "Huawei"];
            const resolutions = ["(390.0, 844.0)", "(414.0, 896.0)", "(375.0, 812.0)", "(428.0, 926.0)", "(360.0, 780.0)"];
            const versions = ["1.0", "1.1", "1.2", "1.3", "1.4", "1.5", "1.6", "2.0"]
            return {
                event_name: "install_application",
                country: countries[Math.floor(Math.random() * countries.length)],
                id: userId,
                install_time: generateTimestamp(),
                lan: languages[Math.floor(Math.random() * languages.length)],
                model: models[Math.floor(Math.random() * models.length)],
                resolution: resolutions[Math.floor(Math.random() * resolutions.length)],
                scale: Math.floor(Math.random() * 3) + 1, // 1-3
                timestamp: generateTimestamp(),
                version: versions[Math.floor(Math.random() * versions.length)],
            };
        }

        // 生成operations数据
        function generateOperations() {
            const operationTypes = [
                "navi_push", "window", "launch_application", 
                "e_backgroung", "enter_forground_application",
                "present_dismiss", "presnet_p"
            ];
            
            const viewControllers = [
                "HomeViewController", "CreateAiFriendViewController", 
                "MessageViewController", "TabBarViewController",
                "RootLoadingViewController", "ProfileViewController",
                "SettingsViewController"
            ];
            
            const operationsCount = Math.floor(Math.random() * 10) + 5; // 5-14个操作
            const operations = {};
            
            for (let i = 0; i < operationsCount; i++) {
                const operationId = generateUUID();
                const opType = operationTypes[Math.floor(Math.random() * operationTypes.length)];
                const opData = {
                    event_name: opType,
                    timestamp: generateTimestamp()
                };
                
                // 根据操作类型添加不同的字段
                if (opType === "navi_push" || opType === "window") {
                    opData.change_to = viewControllers[Math.floor(Math.random() * viewControllers.length)];
                    if (opType === "navi_push") {
                        opData.current_is = Math.random() > 0.3 ? viewControllers[Math.floor(Math.random() * viewControllers.length)] : "";
                    }
                } else if (opType === "launch_application") {
                    opData.open_time = Math.floor(Math.random() * 5) + 1;
                } else if (opType === "present_dismiss" || opType === "presnet_p") {
                    opData.current_is = viewControllers[Math.floor(Math.random() * viewControllers.length)];
                    if (opType === "presnet_p") {
                        opData.to = viewControllers[Math.floor(Math.random() * viewControllers.length)];
                    }
                }
                
                operations[operationId] = opData;
            }
            
            return operations;
        }

        // 生成单个用户数据
        function generateUserData() {
            const userId = generateUUID();
            return {
                [userId]: {
                    ad_event: generateAdEvents(),
                    userinfo: generateInfo(userId),
                    vc_event: generateOperations()
                }
            };
        }

        // 生成指定数量的用户数据并下载
        function generateAndDownload() {
            const countInput = document.getElementById('userCount');
            const statusElement = document.getElementById('status');
            const userCount = parseInt(countInput.value, 10);
            
            // 验证输入
            if (isNaN(userCount) || userCount < 1 || userCount > 100000) {
                statusElement.textContent = "请输入1到50000之间的有效数字";
                statusElement.className = "error";
                return;
            }
            
            statusElement.textContent = `正在生成数据... 0/${userCount}`;
            statusElement.className = "";
            
            const allUsersData = {};
            
            for (let i = 0; i < userCount; i++) {
                // 更新状态（每10个更新一次，避免频繁DOM操作）
                if (i % 10 === 0) {
                    statusElement.textContent = `正在生成数据... ${i}/${userCount}`;
                }
                
                const userData = generateUserData();
                const userId = Object.keys(userData)[0];
                allUsersData[userId] = userData[userId];
            }
            
            // 转换为JSON字符串
            const jsonData = JSON.stringify(allUsersData, null, 2);
            
            // 创建下载链接
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${userCount}_users_data.json`;
            document.body.appendChild(a);
            
            // 触发下载
            a.click();
            
            // 清理
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                statusElement.textContent = `成功！已生成并下载 ${userCount} 条用户数据`;
            }, 100);
        }
    </script>
</body>
</html>